<!--
‡πÑ‡∏ü‡∏•‡πå: mood_journal_single_page.html
‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå 7 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á" (Single Page App)
‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ: HTML + CSS + JavaScript (Chart.js + EmailJS)

‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ:
1) UI ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
2) ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ 5 ‡∏£‡∏∞‡∏î‡∏±‡∏ö (‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 5 -> 1)
3) ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô array ‡πÉ‡∏ô localStorage ‡∏ï‡∏≤‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
4) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö 7 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á -> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á (Chart.js)
5) ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢ EmailJS
6) ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

*** ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô "SETUP EmailJS" ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ***
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå 7 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</title>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- EmailJS SDK CDN -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    :root{--bg:#f7f9fc;--card:#ffffff;--accent:#4f46e5;--muted:#6b7280}
    *{box-sizing:border-box;font-family:Inter, Roboto, "Noto Sans Thai", system-ui, -apple-system, 'Segoe UI', 'Helvetica Neue', Arial}
    body{margin:0;background:var(--bg);color:#111}
    .wrap{max-width:900px;margin:28px auto;padding:20px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(15,23,42,0.06);}
    h1{margin:0 0 8px 0;font-size:22px}
    p.lead{margin:0 0 12px 0;color:var(--muted)}
    label{display:block;margin-bottom:6px;font-weight:600}
    input[type=email]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef}
    button{cursor:pointer}

    .row{display:flex;gap:12px;align-items:center}
    .emoji-row{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
    .emoji-btn{width:84px;height:84px;border-radius:12px;border:1px solid #e6e9ef;background:#fff;font-size:28px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer}
    .emoji-btn.selected{outline:3px solid rgba(79,70,229,0.18);transform:translateY(-4px)}
    .controls{display:flex;gap:10px;margin-top:10px}
    .btn-primary{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:none}
    .btn-ghost{background:transparent;border:1px solid #ddd;padding:10px 12px;border-radius:10px}
    .muted{color:var(--muted);font-size:13px}

    #moodChart{margin-top:18px}
    #summary{margin-top:12px;padding:12px;border-radius:10px;background:#fbfbff}
    pre{white-space:pre-wrap;word-break:break-word}

    footer{margin-top:18px;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:600px){.emoji-btn{width:64px;height:64px;font-size:22px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå 7 ‡∏ß‡∏±‡∏ô</h1>
      <p class="lead">‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå 7 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡πâ</p>

      <!-- SECTION: Email input -->
      <div id="email-section">
        <label for="userEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•)</label>
        <input id="userEmail" type="email" placeholder="you@example.com" />
        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <button id="startBtn" class="btn-primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <div class="muted">‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ</div>
        </div>
        <div id="emailMsg" class="muted" style="margin-top:8px"></div>
      </div>

      <!-- MAIN APP (‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°) -->
      <div id="main-app" style="display:none;margin-top:14px">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <div class="muted">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</div>
            <div id="displayEmail" style="font-weight:700"></div>
          </div>
          <div style="text-align:right">
            <div class="muted">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
            <div id="progress">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß <strong id="count">0</strong> / 7</div>
          </div>
        </div>

        <hr style="margin:12px 0" />

        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (1 = ‡∏ö‡∏∂‡πâ‡∏á ... 5 = ‡∏¢‡∏¥‡πâ‡∏°‡∏°‡∏≤‡∏Å)</label>
        <div class="emoji-row">
          <button class="emoji-btn" data-score="5">üòÑ<div style="font-size:12px;margin-top:4px">‡∏î‡∏µ‡∏°‡∏≤‡∏Å</div></button>
          <button class="emoji-btn" data-score="4">üôÇ<div style="font-size:12px;margin-top:4px">‡∏î‡∏µ</div></button>
          <button class="emoji-btn" data-score="3">üòê<div style="font-size:12px;margin-top:4px">‡πÄ‡∏â‡∏¢‡πÜ</div></button>
          <button class="emoji-btn" data-score="2">üôÅ<div style="font-size:12px;margin-top:4px">‡πÄ‡∏®‡∏£‡πâ‡∏≤</div></button>
          <button class="emoji-btn" data-score="1">üò°<div style="font-size:12px;margin-top:4px">‡∏ö‡∏∂‡πâ‡∏á</div></button>
        </div>

        <div class="controls">
          <button id="saveBtn" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</button>
          <button id="resetBtn" class="btn-ghost" style="display:none">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà / ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button>
          <div id="status" class="muted"></div>
        </div>

        <canvas id="moodChart" style="display:none;max-width:100%;height:260px"></canvas>
        <div id="summary" style="display:none"></div>
      </div>

      <footer>
        <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå (localStorage) ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ EmailJS ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö 7 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏´‡∏≤‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ EmailJS ‡πÑ‡∏ß‡πâ)
      </footer>
    </div>

    

  <script>
  // -----------------------------
  // CONFIG: ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ EmailJS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
  // -----------------------------
  const EMAILJS_USER_ID = 'YgaXFL--CNWu3M3eU';      // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 'user_xxx' ‡∏´‡∏£‡∏∑‡∏≠ public key
  const EMAILJS_SERVICE_ID = 'service_i6osw67';   // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 'service_xxx'
  const EMAILJS_TEMPLATE_ID = 'template_wm4wqep'; // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 'template_xxx'
  // -----------------------------

  // ‡∏≠‡∏¢‡πà‡∏≤‡πÅ‡∏Å‡πâ‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤

  // ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å init ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô placeholder
  if (EMAILJS_USER_ID && !EMAILJS_USER_ID.includes('YOUR_')) {
    try { emailjs.init(EMAILJS_USER_ID); } catch(e){ console.warn('EmailJS init error', e); }
  }

  // helper selectors
  const $ = id => document.getElementById(id);
  const emailInput = $('userEmail');
  const startBtn = $('startBtn');
  const emailMsg = $('emailMsg');
  const mainApp = $('main-app');
  const displayEmail = $('displayEmail');
  const countEl = $('count');
  const saveBtn = $('saveBtn');
  const resetBtn = $('resetBtn');
  const status = $('status');
  const moodChartEl = $('moodChart');
  const summaryEl = $('summary');

  let selectedScore = null;
  let entries = []; // array of {score, at}
  let currentEmail = null;
  let chart = null;

  function sanitizeEmailKey(email){ return 'mood_journal_' + email.replace(/[^a-z0-9]/gi,'_').toLowerCase(); }

  function loadEntries(email){
    try{
      const raw = localStorage.getItem(sanitizeEmailKey(email));
      if(raw) return JSON.parse(raw);
    }catch(e){ console.error(e); }
    return [];
  }
  function saveEntries(email, arr){ localStorage.setItem(sanitizeEmailKey(email), JSON.stringify(arr)); }
  function clearEntries(email){ localStorage.removeItem(sanitizeEmailKey(email)); }

  function validateEmail(email){ return /\S+@\S+\.\S+/.test(email); }

  startBtn.addEventListener('click', ()=>{
    const v = emailInput.value.trim();
    if(!validateEmail(v)){
      emailMsg.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô you@example.com';
      return;
    }
    emailMsg.textContent = '';
    currentEmail = v;
    entries = loadEntries(currentEmail) || [];
    displayEmail.textContent = currentEmail;

    // toggle UI
    $('email-section').style.display = 'none';
    mainApp.style.display = 'block';
    updateUI();

    // init emailjs if configured
    if (EMAILJS_USER_ID && !EMAILJS_USER_ID.includes('YOUR_')) {
      try{ emailjs.init(EMAILJS_USER_ID); } catch(err){ console.warn('EmailJS init fail', err); }
    }

    // If there are already 7 entries stored, show summary immediately
    if(entries.length >= 7){
      computeSummary();
    }
  });

  // emoji buttons
  document.querySelectorAll('.emoji-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.emoji-btn').forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
      selectedScore = Number(btn.dataset.score);
      status.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå: ' + btn.textContent.trim();
    });
  });

  saveBtn.addEventListener('click', ()=>{
    if(!currentEmail){ status.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡πà‡∏≠‡∏ô'; return; }
    if(selectedScore === null){ status.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'; return; }
    if(entries.length >= 7){ status.textContent = '‡∏Ñ‡∏£‡∏ö 7 ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ'; return; }

    entries.push({score: Number(selectedScore), at: new Date().toISOString()});
    saveEntries(currentEmail, entries);
    // reset selection
    document.querySelectorAll('.emoji-btn').forEach(b=>b.classList.remove('selected'));
    selectedScore = null;
    status.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ';
    updateUI();

    if(entries.length === 7){
      computeSummary();
    }
  });

  resetBtn.addEventListener('click', ()=>{
    if(!currentEmail) return;
    if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏´‡∏°?')){
      clearEntries(currentEmail);
      entries = [];
      updateUI();
      status.textContent = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß';
      summaryEl.style.display='none';
      moodChartEl.style.display='none';
      if(chart){ chart.destroy(); chart=null; }
    }
  });

  function updateUI(){
    countEl.textContent = entries.length;
    saveBtn.disabled = (entries.length >= 7);
    resetBtn.style.display = (entries.length>0)?'inline-block':'none';
    // show simple progress
    if(entries.length>0){
      status.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + entries[entries.length-1].score + ' (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)';
    }
  }

  function computeSummary(){
    // counts of scores 5..1
    const counts = {5:0,4:0,3:0,2:0,1:0};
    let total = 0;
    entries.forEach(e=>{ counts[e.score] = (counts[e.score]||0)+1; total += Number(e.score); });
    const totalScore = total; // 7..35
    const label = getLabel(totalScore);
    const message = getMessage(totalScore);

    // prepare chart data (labels: ‡∏î‡∏µ‡∏°‡∏≤‡∏Å..‡∏ö‡∏∂‡πâ‡∏á)
    const chartLabels = ['‡∏î‡∏µ‡∏°‡∏≤‡∏Å (5)','‡∏î‡∏µ (4)','‡πÄ‡∏â‡∏¢‡πÜ (3)','‡πÄ‡∏®‡∏£‡πâ‡∏≤ (2)','‡∏ö‡∏∂‡πâ‡∏á (1)'];
    const chartData = [counts[5], counts[4], counts[3], counts[2], counts[1]];

    // show summary text
    summaryEl.style.display = 'block';
    summaryEl.innerHTML = `<strong>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°:</strong> ${totalScore} / 35<br/><strong>‡∏ú‡∏•:</strong> ${label}<br/><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${message}`;

    // render chart
    moodChartEl.style.display = 'block';
    const ctx = moodChartEl.getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: chartLabels,
        datasets: [{
          label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          data: chartData,
          // default colors used by Chart.js
          borderWidth: 1
        }]
      },
      options: {
        scales: { y: { beginAtZero:true, precision:0, ticks:{stepSize:1} } },
        plugins: { legend: { display:false } }
      }
    });

    // send email via EmailJS (‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)
    sendEmail(currentEmail, totalScore, label, message, counts);
  }

  function getLabel(total){
    if(total >= 30) return '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ‡∏°‡∏≤‡∏Å';
    if(total >= 24) return '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏î‡∏µ';
    if(total >= 18) return '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏õ‡∏Å‡∏ï‡∏¥/‡πÄ‡∏â‡∏¢‡πÜ';
    if(total >= 12) return '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÅ‡∏¢‡πà';
    return '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å';
  }

  function getMessage(total){
    if(total >= 30) return '‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏•‡∏¢! ‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏î‡∏π‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÜ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏ö‡∏ß‡∏Å‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏ô‡∏∞!';
    if(total >= 24) return '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡∏π‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏î‡∏µ‡∏ô‡∏∞ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏î‡πÉ‡∏™‡πÑ‡∏ß‡πâ‡πÄ‡∏™‡∏°‡∏≠!';
    if(total >= 18) return '‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏°‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏µ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏™‡∏î‡πÉ‡∏™‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏µ‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡∏∞!';
    if(total >= 12) return '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏î‡∏π‡∏ô‡∏∞ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏ô‡∏∞ ‚ù§Ô∏è';
    return '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏á‡∏ô‡πâ‡∏≤ ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πà‡∏ß‡∏á‡∏ô‡∏∞ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÉ‡∏à‡πÄ‡∏¢‡πá‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞ üåø';
  }

  function formatCounts(counts){
	return Object.entries(counts)
		.map(([score, count]) => `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${score} = ${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`)
		.join('\n');
  }

  function sendEmail(toEmail, totalScore, label, messageText, counts){
    // Template parameters sent to EmailJS
    const templateParams = {
      to_email: toEmail,
      total_score: totalScore,
      label: label,
      message: messageText,
      counts: formatCounts(counts)
    };

    // check placeholder config
    if(!EMAILJS_USER_ID || EMAILJS_USER_ID.includes('YOUR_') || !EMAILJS_SERVICE_ID || EMAILJS_SERVICE_ID.includes('YOUR_') || !EMAILJS_TEMPLATE_ID || EMAILJS_TEMPLATE_ID.includes('YOUR_')){
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ EmailJS ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤
      status.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ EmailJS ‚Äî ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ EMAILJS_USER_ID / SERVICE_ID / TEMPLATE_ID ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•';
      console.warn('EmailJS not configured. Skipping send.');
      return;
    }

    status.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•...';
    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams)
      .then(function(response){
        console.log('SUCCESS!', response.status, response.text);
        status.textContent = '‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ';
        // ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        clearEntries(currentEmail);
        resetBtn.style.display = 'none';
      }, function(error){
        console.error('FAILED...', error);
        status.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console';
      });
  }

  // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å localStorage.clear() ‡πÉ‡∏ô Console
  </script>
</body>
</html>
